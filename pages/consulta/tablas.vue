<script setup>
const resourcesStore = useSelectedResources2Store();
const fetchedResources = useFetchedResourcesStore();
const resourceType = 'dataTable';
const paginaActual = ref(0);
const tamanioPagina = 10;
const selected = computed(() => resourcesStore[resourceType].filter((element) => element.isSelected === 1)[0])
const selectedUuid = computed(() => selected.value?.uuid ?? null)
const selectedElement = ref()

const {
  variables,
  datos,
  totalFeatures,
  refetch: fetchTable,
} = useGeoserverDataTable({
  paginaActual: paginaActual.value,
  tamanioPagina: tamanioPagina,
  resource: selectedElement.value,
});

watch(paginaActual, () => {
  fetchTable({
    paginaActual: paginaActual.value,
    tamanioPagina: tamanioPagina,
    resource: selectedElement.value,
  });
});

watch(selectedUuid, ()=>{
  selectedElement.value = fetchedResources.findResources([selectedUuid.value], resourceType)[0]
    paginaActual.value = 0;
    fetchTable({
      paginaActual: paginaActual.value,
      tamanioPagina: tamanioPagina,
      resource: selectedElement.value,
    });
})
</script>

<template>
  <ConsultaLayoutPaneles>
    <template #catalogo>
      <ConsultaLayoutCatalogo
        titulo="Tabulados de datos"
        :resource-type="resourceType"
        etiqueta-elementos="Datos tabulados"
      />
    </template>

    <template #visualizador>
       <div v-if="resourcesStore[resourceType].length === 0" class="contenedor">
        <h1>No hay seleccion</h1>
      </div>
      <div v-else>
        <UiTablaAccesible :variables="variables" :datos="datos" :caption="'una descripciÃ³n'" />
        <UiPaginador
          :total-paginas="Math.ceil(totalFeatures / tamanioPagina)"
          @cambio="paginaActual = $event"
        />
      </div>
    </template>

    <template #seleccion>
    <ConsultaLayoutSeleccion
        titulo="Tabulados de datos"
        :resource-type="resourceType"
        etiqueta-elementos="Datos tabulados"
      />
    </template>
  </ConsultaLayoutPaneles>
</template>
